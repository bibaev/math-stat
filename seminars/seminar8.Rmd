---
title: "seminar8"
author: "bibaev"
date: "4/4/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


Постройте несколько переменных $x_i (N = 30)$, по ним постройте y:

* c нормально распределенными остатками c м.о. = 0
* c нормально распределенными остатками c м.о. = 0, но с outlier
* c любыми другими остатками

Для этих трех случаев постройте линейную регрессию, сравните
результаты, постройте диагностические графики для остатков
(проверка на наличие выбросов, зависимость от fitted, проверка на
нормальность).

```{r}
n = 30
```


## Задание 1
```{r}
x1=rnorm(30,12,4)
x2=rnorm(30,-3,2)
x3=rnorm(30,-1,2)

y=0.5*x1+2*x2+3*x1*x3 + rnorm(30)
fit = glm(formula = y ~ x1 + x2 + x1 * x3)
summary(fit)
residuals(fit)
```

Коэффициенты получились весьма близки к истинным.

```{r}
layout(matrix(c(1,2,3,4),2,2))
plot(fit)
```

```{r}
outlier_count = 3
y=0.5*x1+2*x2+3*x1*x3 + rnorm(30)
for(index in round(runif(outlier_count, min = 1, max = 30))) {
  y[index] = y[index] * 12
}
fit = glm(formula = y ~ x1 + x2 + x1 * x3)
summary(fit)
residuals(fit)
```

Коэффициенты приняли значения очень далекие от истинных + параметры, дисперсия остатков оказалась очень большой.

```{r}
layout(matrix(c(1,2,3,4),2,2))
plot(fit)
```

```{r}
y=0.5*x1+2*x2+3*x1*x3 + runif(n, -10, 10)
fit = glm(formula = y ~ x1 + x2 + x1 * x3)
summary(fit)
residuals(fit)
```

Коэффициенты оказались далеки от истинных значений, дисперсия остатков увеличилась.

```{r}
layout(matrix(c(1,2,3,4),2,2))
plot(fit)
```

## Задача 2

a) Смоделируйте xi и y. Смоделируйте ‘лишний‘ x: 1) x не
зависит от существубщих переменных. 2) x сильно скоррелирован
с какой-либо переменной. Сравните результат.

```{r}
x1=rnorm(30,12,4)
x2=rnorm(30,-3,2)
x3=rnorm(30,-1,2)
x_left = rnorm(30, 8, 5)
y = (0.5 * x1) + (2 * x2) + 3 * (x1 * x3) + rnorm(30)
fit = glm(formula = y ~ x1 + x2 + x1 * x3 + x_left)
summary(fit)
```
Если x_left независим от остальных переменных, то он просто будет учтен с небольшим коэффициентом и не даст большого вклада в модель.

```{r}
x_left = x2 + rnorm(30, 0, 0.2)
fit = glm(formula = y ~ x1 + x2 + x1 * x3 + x_left)
summary(fit)
```
Если `x_left` скоррелирован с другой переменной, то он получает больший коэффициент и начинает учитываться в модели. Причем коээфициент при `x2` оказался "размазан" 

b) Смоделируйте xi и y. Сравните неполную модель и полную (ту,
по которой построен y). Сравните полную модель и модель с
‘лишней‘ переменной
c) Сделайте forward, backward selection для вашей модели по всем
данным (y и все xi)